---
title: "Stuff"
author: "Ryan Gan"
date: "8/29/2017"
output: html_document
---

Trying to find a general fit to Brittni's question without having to simulate new dataframes.

```{r libraries}
library(tidyverse)
```

Simulating data frame provided in document.

```{r sim data}
sim_data <- sort(rep(c(10, 50, 100), 9)) %>% 
  as_tibble() %>%
  rename(cluster = value) %>% 
  group_by(cluster) %>% 
  mutate(n = sort(rep(c(50, 100, 500), 3))) %>% 
  group_by(cluster, n) %>%
  mutate(rate = sort(rep(c(0.10, 0.25, 0.50), 1))) %>% 
  ungroup() %>% 
  mutate(reliability = c(0.515, 0.67, 0.734, 0.658, 0.804, 0.846, 0.912, 0.957, 
          0.968, 0.579, 0.741, 0.793, 0.732, 0.851, 0.885, 0.931, 0.966, 0.975, 
          0.593, 0.749, 0.799, 0.742, 0.856, 0.889, 0.933, 0.967, 0.976),
         n_sqr = sqrt(n))
```

Check first couple rows of data frame.

```{r check data}
head(sim_data)
```

Plot mean response of reliability by sample size, grouped by varying rate and presented in a small-multiples by cluster.

```{r plot}
ggplot(data = sim_data, aes(x = n, y = reliability, color = as.factor(rate))) +
  geom_point() +
  geom_line() +
  facet_wrap(~cluster) +
  theme_bw()
```

Fitting linear model to try and predict reliability given interaction between sample size, cluster, and rate. I put in a square root of n predictor to get the shape somewhat of what I think it should be. 

```{r model}
lin_mod <- lm(reliability ~ n*cluster*rate + n_sqr, data = sim_data)
summary(lin_mod)
```

Apply model estimates to predict reliability given the values to a new data frame. 

```{r new data}
new_data <- sort(rep(seq(from = 10, to = 50, by = 10), 60)) %>% 
  as_tibble() %>% 
  rename(cluster = value) %>% 
  group_by(cluster) %>% 
  mutate(n = sort(rep(seq(from = 25, to = 500, by =25), 3))) %>% 
  group_by(cluster, n) %>% 
  mutate(rate = c(0.10, 0.25, 0.50)) %>% 
  ungroup() %>% 
  mutate(n_sqr = sqrt(n)) %>% 
  mutate(reliability = predict(lin_mod, newdata = ., type = "response"))
```

Update plot that should be a decent approximation. 

```{r new plot}
ggplot(data = new_data, aes(x = n, y = reliability, color = as.factor(rate))) +
  geom_line() +
  facet_wrap(~cluster) +
  theme_bw() 
```

Shape is pretty close. It kind of matches to what they sent Brittni for the simulated value at the cluster of 20, sample size of 100, at rates 0.1 and 0.5. The reliability should never exceed 1 or decrease, but that's because I'm using linear regression to fit a proportion. 

Would be interested to see how well this compares to some responses by Far Harbor. 
